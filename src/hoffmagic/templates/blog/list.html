{% extends "base.html" %}
{% block title %}Writing | hoffmagic{% endblock %}
{% block description %}Articles and essays on various topics.{% endblock %}

{% block content %}
    <h2>Writing</h2>
    <p>Thoughts, insights, and explorations on various topics.</p>
    <div id="posts-list">
        <!-- Posts will be loaded here by JavaScript or rendered server-side -->
        <p>Loading posts...</p>
    </div>

{% endblock %}

{% block scripts %}
<script>
    // Simplified post loading (no pagination controls needed for this style)
    document.addEventListener('DOMContentLoaded', function() {
        // Load posts via API
        loadPosts();
    });

    // Function to load posts from API
    async function loadPosts() {
        const container = document.getElementById('posts-list');
        try {
            // Fetch all posts (or a reasonable number) - adjust page_size if needed
            let apiUrl = `/api/blog?page=1&page_size=100`; // Fetch more posts for a simple list
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            // Render posts
            renderPosts(data.items);
        } catch (error) {
            console.error('Error loading posts:', error);
            container.innerHTML = `<p>Failed to load posts. Please try again later.</p>`;
        }
    }

    // Function to render posts to the DOM
    function renderPosts(posts) {
        const container = document.getElementById('posts-list');
        if (posts.length === 0) {
            container.innerHTML = `<p>No posts found.</p>`;
            return;
        }
        // Simple list format
        container.innerHTML = posts.map(post => `
            <article style="margin-bottom: 2em;">
                 <h3><a href="/blog/${post.slug}">${post.title}</a></h3>
                 <p style="font-size: 0.9em; color: #555;">${new Date(post.publish_date).toLocaleDateString()}</p>
                ${post.summary ? `<p>${post.summary}</p>` : ''}
             </article>
         `).join('');
    }
</script>
{% endblock %}
